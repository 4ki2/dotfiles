# association
alias -s txt=vim
alias -s conf=vim
alias -s csv=vim
alias -s rdoc=vim
alias -s erb=vim
alias -s slim=vim
alias -s yml=vim

# user and consoles
alias p=pwd
alias h=history
alias cl=clear
alias cle=cl
alias clea=cl
alias cler=cl
alias e=exit
alias ex=e
alias exi=e

# process
alias top="top -c"
alias kk="kill -9"

# file system
alias ...="../.."
alias ....="../../.."
alias .....="../../../.."
alias ......="../../../../.."
alias du="du -h --max-depth=1"
alias cp="cp -ip"
alias d=colordiff
alias dr="colordiff -r"
alias drx="colordiff -r --exclude='.*'"
alias mv="mv -i"
alias rm="rm -i"
alias untgz="tar xzvf"

# ls
alias ls="ls -F --color=auto"
alias l="ls -C"
alias la="ls -A"
alias ll="ls -alh"

# pager
alias le="less -r"
alias les=le
alias less=le
alias lesss=le

# grep
alias grep="grep --color=auto"
alias fgrep="fgrep --color=auto"
alias egrep="egrep --color=auto"
$ gr() { grep -nriI $1 . }
alias gralias="alias|grep -i"
alias grenv="env|grep -i"
alias grps="ps aux|grep -i"

# find
alias f="find . -iname"
alias fr="find / -path \"/mnt\" -prune -o -path \"/etc\" -prune -o -path \"/proc\" -prune -o -path \"/var\" -prune -o -path \"/sys\" -prune -o -path \"/root\" -prune -o -path \"/lost+found\" -prune -o -path \"/tmp/vmware-root\" -prune -o"
alias findroot=fr
alias fc="find . -maxdepth 1"
alias findcurrent=fc

# editor
alias vim="vim -p"
alias v=vim
alias va="vim ~/.aliases"
alias vc="vim ~/.ssh/config"
alias ve="vim ~/.env"
alias vg="vim ~/.gitconfig"
alias vs="vim ~/.secrets"
alias vt="vim ~/.tmux.conf"
alias vv="vim ~/.vimrc"
alias vz="vim ~/.zshrc"
alias sudovim="sudo -H vim"

# network
alias ip="LANG=C ifconfig|grep 'inet addr'|cut -d: -f2|cut -d' ' -f1|grep -v 127.0.0.1"
alias ssh="slogin -o ServerAliveInterval=60 -F ~/.ssh/config"
$ port() { sudo lsof -n -i:$1; }

# git
alias g="git"
alias gi="g init"
alias gb="g b"
alias gcm="g config user.email"
alias gcn="g config user.name"
alias gd="g d"
alias gs="g s"
alias gl="g l"
alias gw="g w"
if [ -f ~/.gitrc ]; then
  . ~/.gitrc
fi
alias grco_check="find . -type d -name .git"
git_recursive_checkout() {
  local readonly base_path=`pwd`
  for d in `grco_check`; do
    cd `dirname $d`
    git add .
    git stash
    git checkout $1
    cd $base_path
  done
}
alias grco_master="git_recursive_checkout master"
alias grco_localdev="git_recursive_checkout localdev"

# subversion
export SVN_EDITOR=vim
alias sa="svn add"
alias sc="svn commit -m"
alias sd="svn diff"
alias sl="svn log"
alias sll="svn log|less"
alias sr="svn revert"
alias su="svn update"

# heroku
alias helog="heroku logs --tail"

# reloader
alias reloadrc=". ~/.zshrc"
alias reloadalias=". ~/.aliases"
alias reloadenv=". ~/.env"
alias reloadsecret=". ~/.secrets"

# configure
alias configurevim="./configure --disable-darwin --disable-smack --disable-selinux --disable-xsmp --enable-luainterp=yes --enable-rubyinterp=yes --enable-cscope --disable-netbeans --enable-multibyte --enable-fontset --enable-gui=no --disable-gtktest --disable-gpm --with-features=huge"
alias configuretmux="sh autogen.sh; ./configure"

# daemon control
alias redisflush="redis-cli flushall; sudo service redis-server restart"

# dependency base system
# check os
CURRENT_OS=`uname -s`
if [ -f /etc/issue ]; then
  CURRENT_OS=`head -n 1 /etc/issue`
fi
case $CURRENT_OS in

  Ubuntu*);

    # package manager
    alias aptsafe="sudo aptitude update; sudo aptitude safe-upgrade"
    alias aptpurge="sudo apt-get autoremove; sudo apt-get clean"
    alias aptsearch="aptitude search"
    alias aptinstall="sudo aptitude install"
    $ aptalready() { aptitude search $1 | grep ^i }

    # system
    alias halt="sudo shutdown -h now"
    alias reboot="sudo shutdown -r now"

    # daemon control
    alias servstat="service --status-all"
    alias pgc="psql -U postgres"

    # rails
    alias b=bundle
    alias bu="bundle update"
    alias sq="bundle exec sidekiq -C config/sidekiq.yml"
    alias production="export RAILS_ENV=production"
    alias staging="export RAILS_ENV=staging"
    alias development="unset RAILS_ENV"
    alias r=rails
    alias rc="rails c"
    alias rs="rails s"
    alias rsp="rails s -e production"
    alias resetdb="bundle exec rake db:drop; bundle exec rake db:create; bundle exec rake db:migrate"
    alias precompile="bundle exec rake assets:precompile"
    alias railsclear="bundle exec rake assets:clean; bundle exec rake tmp:clear; bundle exec rake log:clear"
    alias vr="LANG=C vim -p app/assets/stylesheets app/assets/javascripts app/helpers app/views app/models app/controllers config db"

    ### Added by the Heroku Toolbelt
    export PATH="/usr/local/heroku/bin:$PATH"

    # ruby
    if [ -d ~/.rbenv ]; then
      export RBENV_ROOT="${HOME}/.rbenv"
      export PATH="${RBENV_ROOT}/bin:${PATH}"
      eval "$(rbenv init -)"
      source $RBENV_ROOT/completions/rbenv.zsh
      export BUNDLER_EDITOR=vim
      export TRUSTED_IP=127.0.0.1 # mailcatcher
      alias rv="ruby -v|cut -d' ' -f2"
      $ rch() { rbenv local $1; rbenv rehash; . ~/.aliases}
      alias rls="rbenv versions"
      alias rbupdate="cd ~/.rbenv; git pull; cd plugins/ruby-build; git pull; cd; rbenv rehash"
      alias rbremote="echo '  remote'; rbenv install -l | grep '^  2\|^  1.9' | grep -v '\-dev\|\-preview\|\-rc\|1.9.1\|1.9.2'"
      alias rbrehash="rbenv rehash"
      alias gems="echo `rbenv which ruby|sed -e 's/bin\/ruby//'`lib/ruby/gems/`case $(rv) in 1.9.*) echo 1.9.1;; 2.1.*) echo 2.1.0;; 2.2.*) echo 2.2.0;; *) rv|cut -d'p' -f1;; esac`/gems"
      alias gemupdate="gem cleanup; gem update --system; rbenv rehash; gem update; rbenv rehash; gem pristine --all; rbenv rehash"
      alias gemenv="gem env"
      alias cdgems="cd `gems`"
      $ gemlist() { gem list ^$1\$ --remote --all; }
      alias mailcatcher="mailcatcher --http-ip `ip|head -1`"
    fi

    CURRENT_OS=Ubuntu;;

  CentOS*);

    # perl
    alias pv="perl -v|grep -o '(v[0-9]\+.[0-9]\+.[0-9]\+)'|grep -o '[0-9.]\+'"
    $ fp(){ find `echo \`pmdirs\`` -iname $1* } # require pmtools
    alias findperl=fp
    alias clean_perl_test="find . -iname debug.txt -o -iname save.txt|xargs rm -rv"

    # tokyocabinet
    export TOKYOCABINET_HOST=localhost
    export TOKYOCABINET_PORT=11978
    alias tclist="tcrmgr list $TOKYOCABINET_HOST:$TOKYOCABINET_PORT"
    alias tcpurge="tcrmgr vanish $TOKYOCABINET_HOST:$TOKYOCABINET_PORT"
    alias tcget="tcrmgr get $TOKYOCABINET_HOST:$TOKYOCABINET_PORT"
    alias tcset="tcrmgr put $TOKYOCABINET_HOST:$TOKYOCABINET_PORT"
    alias tcdel="tcrmgr out $TOKYOCABINET_HOST:$TOKYOCABINET_PORT"

    # daemon control
    DEV_SERVS=(`cat <<_SERVS_
mysqld
memcached
redis
hyperestraier
mogilefsd
mogstored
tokyotyrant
httpd
_SERVS_`)
    $ services() { for s in $DEV_SERVS; do; sudo /etc/init.d/$s $1 & wait; done; }

    CURRENT_OS=CentOS;;

  Darwin*) CURRENT_OS=Mac;;
esac
